{% load static %}
{% load humanize %}

<div class="mt-10 mb-6">
    <h2 class="text-2xl font-bold text-white">All Professional Teams</h2>
    <p class="text-slate-400 text-sm">Explore every registered team, their stats, and player rosters</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for team in teams %}
    <div class="group bg-slate-800/50 border {% if highlight_id and team.id|stringformat:'s' == highlight_id %}border-emerald-400 ring-2 ring-emerald-300{% else %}border-slate-800{% endif %} rounded-xl overflow-hidden shadow-lg hover:shadow-emerald-500/10 transition-all duration-300 flex flex-col">

        <!-- Banner + status badge -->
        <div class="relative">
            {% if team.banner %}
                <img src="{{ team.banner.url }}" alt="{{ team.name }} banner"
                     class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
            {% else %}
                <div class="w-full h-32 bg-slate-700"></div>
            {% endif %}

            <div class="absolute top-3 left-3">
                {% if team.status_indicator == 'live' %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold bg-red-600 text-white shadow-sm">
                        <i data-lucide="zap" class="w-3 h-3"></i> Live
                    </span>
                {% elif team.status_indicator == 'upcoming' %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold bg-amber-500 text-white shadow-sm">
                        <i data-lucide="clock" class="w-3 h-3"></i> Upcoming
                    </span>
                {% endif %}
            </div>

            <!-- Logo -->
            <div class="absolute -bottom-8 left-6">
                {% if team.logo %}
                    <img class="h-16 w-16 rounded-full border-4 border-slate-800" src="{{ team.logo.url }}" alt="{{ team.name }} logo">
                {% else %}
                    <img class="h-16 w-16 rounded-full border-4 border-slate-800" src="{% static 'images/placeholder-logo.png' %}" alt="placeholder logo">
                {% endif %}
            </div>
        </div>

        <!-- Card body -->
        <div class="p-6 pt-10 flex flex-col flex-1">
            <div class="flex items-start justify-between">
                <h3 class="text-lg font-bold text-white group-hover:text-emerald-400 transition-colors">
                    {{ team.name }}
                </h3>
                {% if highlight_id and team.id|stringformat:'s' == highlight_id %}
                <span class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-emerald-900/30 text-emerald-300 border border-emerald-600/40">
                    <i data-lucide="sparkles" class="w-3 h-3"></i> New
                </span>
                {% endif %}
            </div>

            <!-- Description snippet -->
            {% if team.description %}
            <p class="text-slate-300 text-sm mt-2 line-clamp-3">{{ team.description }}</p>
            {% endif %}

            <div class="flex items-center justify-between text-sm text-slate-400 mt-2">
                <span class="inline-flex items-center gap-1">
                    <i data-lucide="map-pin" class="w-4 h-4"></i> {{ team.region|default:"—" }}
                </span>
                <span class="inline-flex items-center gap-1">
                    <i data-lucide="calendar" class="w-4 h-4"></i> Est. {{ team.founded|default:"—" }}
                </span>
            </div>

            {% if team.next_match_date %}
            <div class="mt-1 text-xs text-slate-400 inline-flex items-center gap-1">
                <i data-lucide="calendar-days" class="w-4 h-4"></i>
                Next: {{ team.next_match_date|date:"M d" }} {{ team.next_match_date|time:"g:i A" }}
            </div>
            {% endif %}

            <!-- Stats block -->
            <div class="grid grid-cols-4 gap-2 text-center mt-4 pt-4 border-t border-slate-700">
                <div>
                    <div class="text-lg font-bold text-emerald-400">{{ team.matches_played|intcomma }}</div>
                    <div class="text-xs text-slate-400">Matches Played</div>
                </div>
                <div>
                    <div class="text-lg font-bold text-emerald-400">{{ team.win_rate }}%</div>
                    <div class="text-xs text-slate-400">Win Rate</div>
                </div>
                <div>
                    <div class="text-lg font-bold text-emerald-400">{{ team.wins|intcomma }}</div>
                    <div class="text-xs text-slate-400">Total Wins</div>
                </div>
                <div>
                    <div class="text-lg font-bold text-emerald-400">{{ team.championships|intcomma }}</div>
                    <div class="text-xs text-slate-400 truncate">Championships</div>
                </div>
            </div>

            <!-- Player avatars -->
            {% if team.players.exists %}
            <div class="mt-4">
                <p class="text-slate-300 text-sm mb-2">Players ({{ team.players.count }})</p>
                <div class="flex -space-x-2">
                    {% for player in team.players.all %}
                        {% if player.avatar %}
                            <img src="{{ player.avatar.url }}" alt="{{ player.name }}"
                                 title="{{ player.name }}{% if player.role %} — {{ player.role }}{% endif %}"
                                 class="w-10 h-10 rounded-full border-2 border-slate-800">
                        {% else %}
                            <img src="{% static 'images/placeholder-avatar.png' %}" alt="{{ player.name }}"
                                 title="{{ player.name }}{% if player.role %} — {{ player.role }}{% endif %}"
                                 class="w-10 h-10 rounded-full border-2 border-slate-800">
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Footer buttons -->
            <div class="mt-auto pt-6 flex items-center justify-between gap-3">
                <a href="{% url 'team_detail' team.id %}"
                   class="flex-1 text-center inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium border border-slate-600 bg-slate-700 hover:bg-slate-600 h-9 px-4 py-2">
                    <i data-lucide="users" class="w-4 h-4"></i> View Team
                </a>
                <a href="{% url 'team_tournaments' team.id %}"
                   class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium border border-slate-600 bg-slate-700 hover:bg-slate-600 h-9 px-3 py-2"
                   title="Team tournaments stats">
                    <i data-lucide="trophy" class="w-4 h-4"></i>
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-slate-400 col-span-full text-center">No teams found.</p>
    {% endfor %}
</div>